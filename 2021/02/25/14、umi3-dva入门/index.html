

<!DOCTYPE html>
<html lang="zh-cn" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>14、umi3+dva - 张周文</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="基础1234567891011121314151617...">
  <meta name="author" content="张周文">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_s6x2xcokxrl.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '/images/theme/loading.gif'
      },
      donate: {
        enable: true,
        alipay: 'https://pic.izhaoo.com/alipay.jpg',
        wechat: 'https://pic.izhaoo.com/wechat.jpg'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '/images/theme/bg.jpg',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        model: 'simple'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.3.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconqrcode j-navbar-qrcode"></i>
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
    </div>
    <div class="center">14、umi3+dva</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
      <div id="qrcode-navbar"></div>
    
  </nav>

  

<nav class="menu">
  <div class="menu-wrap">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 摄影</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Main - <a target="_blank" href="https://github.com/Dachuizi-6">大帅比</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/images/theme/post-cover.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">14、umi3+dva</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>二月 25, 2021</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>29911</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、箭头函数</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、析构赋值</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">    name:<span class="string">&quot;大帅比&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> &#123;name&#125; = a</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = &#123;</span><br><span class="line">    name:<span class="string">&quot;大帅比&quot;</span>,</span><br><span class="line">    age:<span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;name,...rest&#125; = b</span><br><span class="line"><span class="built_in">console</span>.log(rest) <span class="comment">// &#123;age:18&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、json转换</span><br><span class="line"><span class="built_in">JSON</span>.stringify() <span class="comment">// 先json再变成字符串</span></span><br><span class="line"><span class="built_in">JSON</span>.parse()</span><br><span class="line"></span><br><span class="line"><span class="number">04</span>、异步相关</span><br><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">function_name</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    yeild 异步任务 <span class="comment">// 等异步任务执行之后，才往下</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">function_name</span>(<span class="params">params</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">await</span> 异步动作</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="DVA-介绍"><a href="#DVA-介绍" class="headerlink" title="DVA 介绍"></a>DVA 介绍</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DVA = (redux、redux-saga、react-router)</span><br><span class="line"></span><br><span class="line">UMI = DVA + 插件</span><br><span class="line"></span><br><span class="line">UMI主要是路由的简化</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DVA：公共数据******model******（以前redux里面的store）</span><br><span class="line">    同步数据（reducer）</span><br><span class="line">    异步数据（effect）</span><br><span class="line">        页面（dispatch分发）---&gt; reducer（connect） ---&gt;页面</span><br><span class="line">        页面（dispatch分发）---&gt; effect（put(给)） ---&gt;页面</span><br><span class="line"></span><br><span class="line">    订阅（subscription）（dva快捷方法）</span><br><span class="line">        subscription（dispatch(分派)）---&gt;effect</span><br><span class="line"></span><br><span class="line">私有数据：state</span><br><span class="line"></span><br><span class="line">页面 &lt;---&gt; effect(call(召唤)) &lt;---&gt; service</span><br></pre></td></tr></table></figure>
<h3 id="小例子文件结构"><a href="#小例子文件结构" class="headerlink" title="小例子文件结构"></a>小例子文件结构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">users (tsx参与界面展示，有jsx语法)</span><br><span class="line">    index.tsx</span><br><span class="line">    model.ts</span><br><span class="line">    service.ts <span class="comment">// 里面都是异步函数</span></span><br><span class="line">    components/UserModal.tsx</span><br><span class="line"></span><br><span class="line">umi配置：.umirc.ts(默认有路由配置，所以不是约定式路由)</span><br><span class="line"></span><br><span class="line">全局样式</span><br><span class="line">Umi 中约定 src/<span class="built_in">global</span>.css 为全局样式，如果存在此文件，会被自动引入到入口文件最前面。(写样式后需要重启)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="搭建基础页面"><a href="#搭建基础页面" class="headerlink" title="搭建基础页面"></a>搭建基础页面</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、写样式、引入antd的Table</span><br><span class="line"><span class="number">02</span>、第一步：用户访问users，通过订阅者调用reducer返回仓库数据给页面（页面的state包含有model的namespace）</span><br><span class="line">    (&#123;users&#125;) =&gt; (&#123;users&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="umi-跟-dva-结合"><a href="#umi-跟-dva-结合" class="headerlink" title="umi 跟 dva 结合"></a>umi 跟 dva 结合</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、</span><br><span class="line">把静态的data放到dav的同步数据reducer里面的save里面并返回</span><br><span class="line">组件使用的时候跟redux的写法一样，只不过connect是直接从umi里面导出</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123;users&#125;</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        users</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table的dataSource可以通过props拿到users</span><br><span class="line"></span><br><span class="line">此处用户访问uses的时候，subscription监听到路由，dispatch一个reducer，返回数据的名称就是namespace对应的字段，就可以拿到数据了</span><br><span class="line">所以我们的页面通过connect方式绑定到了仓库，这就实现了umi和dva的结合</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">02</span>、dva本质写法</span><br><span class="line"><span class="keyword">const</span> UserModel = &#123;</span><br><span class="line">    namespace:<span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">    state:&#123;&#125;,</span><br><span class="line">    reducers:&#123;</span><br><span class="line">        <span class="function"><span class="title">getList</span>(<span class="params">state,action</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> newState;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    effects:&#123;</span><br><span class="line">        *<span class="function"><span class="title">function_name</span>(<span class="params">action,effects</span>)</span>&#123;</span><br><span class="line">            yeild put()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    subscriptions:&#123;</span><br><span class="line">        <span class="function"><span class="title">function_name</span>(<span class="params">&#123;dispatch ,history&#125;,done</span>)</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">effect无需返回值</span><br><span class="line"></span><br><span class="line">dispatch(action)</span><br><span class="line">action = &#123;</span><br><span class="line">    type:<span class="string">&quot;getList&quot;</span>,</span><br><span class="line">    payLoad:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="走订阅和-reducer"><a href="#走订阅和-reducer" class="headerlink" title="走订阅和 reducer"></a>走订阅和 reducer</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">03</span>、手写model  +  ts</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Reducer,Effect,Subscription &#125; <span class="keyword">from</span> <span class="string">&quot;umi&quot;</span></span><br><span class="line"></span><br><span class="line">interface UserModelType &#123;</span><br><span class="line">    namespace:<span class="string">&#x27;users&#x27;</span>;</span><br><span class="line">    state:&#123;&#125;;</span><br><span class="line">    reducers:&#123;</span><br><span class="line">        getList:Reducer</span><br><span class="line">    &#125;;</span><br><span class="line">    effects:&#123;&#125;;</span><br><span class="line">    subscriptions:&#123;</span><br><span class="line">        setup:Subscription</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserModel:UserModelType = &#123;</span><br><span class="line">    namespace:<span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">    state:&#123;&#125;,</span><br><span class="line">    reducers:&#123;</span><br><span class="line">        <span class="function"><span class="title">getList</span>(<span class="params">state,action</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> data = []</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    effects:&#123;&#125;,</span><br><span class="line">    subscriptions:&#123;</span><br><span class="line">        <span class="function"><span class="title">setup</span>(<span class="params">&#123;dispatch,history&#125;</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> history.listen(<span class="function">(<span class="params">&#123;pathname&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(pathname === <span class="string">&#x27;/users&#x27;</span>)&#123;</span><br><span class="line">              dispatch(&#123;</span><br><span class="line">                type:<span class="string">&#x27;getList&#x27;</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UserModel</span><br></pre></td></tr></table></figure>
<h3 id="TS-加持"><a href="#TS-加持" class="headerlink" title="TS 加持"></a>TS 加持</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umi对reducers，effets，subscribtions有默认的类型声明</span><br><span class="line">固定值就直接可使用固定值</span><br></pre></td></tr></table></figure>
<h3 id="走订阅-effect-reducer-connect"><a href="#走订阅-effect-reducer-connect" class="headerlink" title="走订阅+effect+reducer+connect"></a>走订阅+effect+reducer+connect</h3><h3 id="异步处理完整流程数据流-service—-gt-effects—-gt-reducer"><a href="#异步处理完整流程数据流-service—-gt-effects—-gt-reducer" class="headerlink" title="异步处理完整流程数据流 service—&gt;effects—&gt;reducer"></a>异步处理完整流程数据流 service—&gt;effects—&gt;reducer</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">页面监听，订阅以后分发effects，effects然后call（services）再put给reducers，reducer再最后返回</span><br><span class="line"><span class="comment">// 第一步</span></span><br><span class="line">interface UserModelType &#123;</span><br><span class="line">  effects: &#123;</span><br><span class="line">    getRemote: Effect,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserModel: UserModelType = &#123;</span><br><span class="line">  namespace: <span class="string">&quot;users&quot;</span>,</span><br><span class="line">  state: &#123;&#125;,</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    <span class="function"><span class="title">getList</span>(<span class="params">state, &#123; payload &#125;</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> payload;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  effects: &#123;</span><br><span class="line">    *<span class="function"><span class="title">getRemote</span>(<span class="params">action, &#123; put, call &#125;</span>)</span> &#123; <span class="comment">// effects找reducers用put，找service用call</span></span><br><span class="line">    <span class="comment">// 这里的action没用到</span></span><br><span class="line">      <span class="keyword">const</span> data = [];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">&quot;getList&quot;</span>,</span><br><span class="line">        payload: data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  subscriptions:&#123;</span><br><span class="line">        <span class="function"><span class="title">setup</span>(<span class="params">&#123;dispatch,history&#125;</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> history.listen(<span class="function">(<span class="params">&#123;pathname&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(pathname === <span class="string">&#x27;/users&#x27;</span>)&#123;</span><br><span class="line">              dispatch(&#123;</span><br><span class="line">                <span class="comment">// type:&#x27;getList&#x27; // 不是同步的了</span></span><br><span class="line">                type:<span class="string">&#x27;getRemote&#x27;</span> <span class="comment">// 异步</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">现在谁来触发effects呢，把订阅subscriptions中的dispatch中的type改成effects中的函数名即可</span><br><span class="line"></span><br><span class="line">### ****************************************************************走异步函数（加async）*******************************</span><br><span class="line"><span class="comment">// 第二步</span></span><br><span class="line"><span class="comment">// 现在模拟请求接口</span></span><br><span class="line">services文件：</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRemoteList = <span class="keyword">async</span> params =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> data = []</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line">model文件中引入：</span><br><span class="line"><span class="keyword">import</span> &#123;getRemoteList&#125; <span class="keyword">from</span> <span class="string">&quot;./services&quot;</span></span><br><span class="line"></span><br><span class="line">reducers: &#123;</span><br><span class="line">    <span class="function"><span class="title">getList</span>(<span class="params">state, &#123; payload &#125;</span>)</span> &#123;   *******************解构一个action*********************************</span><br><span class="line">      <span class="keyword">return</span> payload;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">effects: &#123;</span><br><span class="line">    *<span class="function"><span class="title">getRemote</span>(<span class="params">action, &#123; put, call &#125;</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">yield</span> call(getRemoteList)    ************************注意加<span class="keyword">yield</span>************************************</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">&quot;getList&quot;</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">            data <span class="comment">// 要这样写，再去用到数据的地方改写</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&lt;Table dataSource=&#123;users.data&#125; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三步：真正调用后端接口</span></span><br><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&quot;umi&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRemoteList = <span class="keyword">async</span> params =&gt;&#123;</span><br><span class="line">    <span class="comment">// return 记住return</span></span><br><span class="line">    <span class="keyword">return</span> request(<span class="string">&quot;http://public-api-v1.aspirantzhang.com/users&quot;</span>,&#123;</span><br><span class="line">        methods:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">effects: &#123;</span><br><span class="line">    *<span class="function"><span class="title">getRemote</span>(<span class="params">action, &#123; put, call &#125;</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">yield</span> call(getRemoteList)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">&quot;getList&quot;</span>,</span><br><span class="line">        payload:data <span class="comment">// 这个data不是简单的数组对象结构</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Dav-用来-model-自动启用"><a href="#Dav-用来-model-自动启用" class="headerlink" title="Dav:用来 model 自动启用"></a>Dav:用来 model 自动启用</h3><h3 id="代理-只在开发的时候好使"><a href="#代理-只在开发的时候好使" class="headerlink" title="代理,只在开发的时候好使"></a>代理,只在开发的时候好使</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.umirc.ts</span><br><span class="line">proxy: &#123;</span><br><span class="line">    <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;target&#x27;</span>: <span class="string">&#x27;http://jsonplaceholder.typicode.com/&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;changeOrigin&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;pathRewrite&#x27;</span>: &#123; <span class="string">&#x27;^/api&#x27;</span> : <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> request(<span class="string">&quot;/api/users&quot;</span>,&#123;</span><br><span class="line">        methods:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="umi-的一些配置"><a href="#umi-的一些配置" class="headerlink" title="umi 的一些配置"></a>umi 的一些配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、使用dva默认配置开启，一旦用来model则就开启dva插件了</span><br><span class="line"><span class="number">02</span>、request请求插件也是默认开启的</span><br></pre></td></tr></table></figure>
<h3 id="奇怪的点"><a href="#奇怪的点" class="headerlink" title="奇怪的点"></a>奇怪的点</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、</span><br><span class="line"><span class="keyword">return</span> res.data</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、</span><br><span class="line">*<span class="function"><span class="title">getRemoteList</span>(<span class="params">action,&#123;put,call&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">yield</span> call(getRemoteListData)</span><br><span class="line">    <span class="built_in">console</span>.log(data,<span class="string">&quot;返回结果&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type:<span class="string">&#x27;getList&#x27;</span>,</span><br><span class="line">        payLoad:&#123;data&#125; <span class="comment">// 得这样写</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、</span><br><span class="line">reducers:&#123;</span><br><span class="line">    <span class="function"><span class="title">getList</span>(<span class="params">state,&#123;payLoad&#125;</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(payLoad,<span class="string">&quot;555&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> payLoad <span class="comment">// 此处的payLoad返回一个对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="引入-Modal-子组件，通过属性的方式控制显示影藏（在父组件定义一个状态）"><a href="#引入-Modal-子组件，通过属性的方式控制显示影藏（在父组件定义一个状态）" class="headerlink" title="引入 Modal 子组件，通过属性的方式控制显示影藏（在父组件定义一个状态）"></a>引入 Modal 子组件，通过属性的方式控制显示影藏（在父组件定义一个状态）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">点击改变状态，传给子组件</span><br><span class="line"></span><br><span class="line">实现modal框的确定和取消按钮点击逻辑，因为状态在父组件那里，所以取消的回调定义在父组件里头</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="接下来的流程"><a href="#接下来的流程" class="headerlink" title="接下来的流程"></a>接下来的流程</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、拿到数据给Table赋值</span><br><span class="line"><span class="number">02</span>、修改弹窗显示内容结构（表单）</span><br><span class="line"><span class="number">03</span>、给表单搞默认值(三步)</span><br><span class="line"></span><br><span class="line">  ###  ***********************父组件点击编辑把单条数据rowData通过属性传递给子组件**************************************</span><br><span class="line">  <span class="keyword">const</span> [form] = Form.useForm();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">()=&gt;</span>&#123; <span class="comment">// 在渲染的时候不要赋值，在页面挂载之后才赋值</span></span><br><span class="line">    form.setFieldsValue(rowData); <span class="comment">// const [rowData,setRowData] = useState(&#123;&#125;) 点击编辑的时候保存的一行值 // 给表单赋值初始值、可更新</span></span><br><span class="line">    <span class="comment">// initialValues:只在初始化的时候有效，不能更新</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// rowData是一个对象，属性为Form.Item对应的name属性</span></span><br><span class="line">  &#125;,[visible])</span><br><span class="line"></span><br><span class="line">  &lt;Form form=&#123;form&#125;&gt;&lt;/Form&gt;</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line"><span class="number">01</span>、Modal中用Form报警告问题：forceRender</span><br></pre></td></tr></table></figure>
<h3 id="点击-Modal-的-ok-来触发表单的提交"><a href="#点击-Modal-的-ok-来触发表单的提交" class="headerlink" title="****************点击 Modal 的 ok 来触发表单的提交****************"></a>*<strong>*****</strong>*****<strong>*****</strong>点击 Modal 的 ok 来触发表单的提交*<strong>*****</strong>*****<strong>*****</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">点击提交onOk，触发表单的onFinish，修改仓库数据（dispatch(从state中解构出来)，注意action的type写法），然后call（接口，注意传参）再和后端接口交流</span><br><span class="line">onFinish的形参默认接收表单的name属性对应的值</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="处理修改逻辑"><a href="#处理修改逻辑" class="headerlink" title="处理修改逻辑"></a>处理修改逻辑</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、点击编辑：modal弹框，点击modal的ok按钮，要触发表单的提交（onFinish方法需要放在父级页面中调用，通过属性传递给子组件，因为子组件不能和仓库进行沟通）</span><br><span class="line">    <span class="keyword">const</span> onOk = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        form.submit();</span><br><span class="line">    &#125;;</span><br><span class="line">该方法一调用就会触发form表单的onFinish方法</span><br><span class="line"><span class="keyword">const</span> onFinish = <span class="function">(<span class="params">values: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Finish:&#x27;</span>, values);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> id = rowData.id</span><br><span class="line">    <span class="comment">// 这里把修改数据提交到仓库，仓库再调用service中的接口改变仓库数据，最后通过reducer把新数据给到页面</span></span><br><span class="line">    <span class="comment">// 需要用到dispatch（从props里面来）</span></span><br><span class="line">    dispatch(&#123;</span><br><span class="line">        type:<span class="string">&#x27;users/edit&#x27;</span>, <span class="comment">// 页面写法一定要这样子写</span></span><br><span class="line">        payload:&#123;</span><br><span class="line">            values,</span><br><span class="line">            id <span class="comment">// 把id传到model中</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改成功之后关闭弹窗</span></span><br><span class="line">    setIsShowModal(<span class="literal">false</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、去写service接口</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> edit = <span class="keyword">async</span> ( &#123;id,values&#125; ) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> request(<span class="string">`http://public-api-v1.aspirantzhang.com/users/<span class="subst">$&#123;id&#125;</span>`</span>,&#123;</span><br><span class="line">    method:<span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    data:values <span class="comment">// ******************* 注意valus本来就是对象了 *********************</span></span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;ok&quot;</span>); <span class="comment">// 通过状态码来判断有无添加成功</span></span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、effects:&#123;</span><br><span class="line">    <span class="comment">// &#123; payload: &#123; id,values &#125; &#125; 双重解构，action和payload</span></span><br><span class="line">    *<span class="function"><span class="title">edit</span>(<span class="params">&#123;payload:&#123;id,values&#125;&#125;,&#123;put,call&#125;</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// console.log(&#x27;edit here&#x27;)</span></span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">yield</span> call(edit,&#123;id,values&#125;) <span class="comment">// ************* 注意call的传参方法 *************</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="处理完修改后，应该调用-异步的-effect-请求列表数据"><a href="#处理完修改后，应该调用-异步的-effect-请求列表数据" class="headerlink" title="处理完修改后，应该调用***********异步的 effect 请求列表数据*****************"></a>处理完修改后，应该调用<strong>****</strong>***<strong>****</strong>异步的 effect 请求列表数据*<strong>*******</strong>**<strong>*******</strong></h3><h3 id="处理删除逻辑"><a href="#处理删除逻辑" class="headerlink" title="处理删除逻辑"></a>处理删除逻辑</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、</span><br><span class="line">    <span class="comment">// 确认删除</span></span><br><span class="line">  <span class="keyword">const</span> confirm = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    props.dispatch(&#123;</span><br><span class="line">      type:<span class="string">&quot;users/delete&quot;</span>,</span><br><span class="line">      payload:&#123;id&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="number">02</span>、</span><br><span class="line">    <span class="comment">// 删除一条数据</span></span><br><span class="line">      *<span class="function"><span class="title">delete</span>(<span class="params">&#123;payload:&#123;id&#125;&#125;,&#123;put,call&#125;</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">yield</span> call(deleteOneList,&#123;id&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 成功之后更新页面</span></span><br><span class="line">        <span class="keyword">yield</span> put(&#123;</span><br><span class="line">            type:<span class="string">&quot;getRemote&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"><span class="number">03</span>、</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> deleteOneList = <span class="keyword">async</span> (&#123;id&#125;) =&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> request(<span class="string">`http://public-api-v1.aspirantzhang.com/users/<span class="subst">$&#123;id&#125;</span>`</span>,&#123;</span><br><span class="line">    method:<span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除成功之后给提示</span></span><br><span class="line">    message.success(<span class="string">&quot;Delete successfully&quot;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line"></span><br><span class="line">    message.error(<span class="string">&quot;Delete failed&quot;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="处理添加逻辑"><a href="#处理添加逻辑" class="headerlink" title="处理添加逻辑"></a>处理添加逻辑</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、添加一个按钮，点击打开弹窗</span><br><span class="line">    &lt;Button type=<span class="string">&quot;primary&quot;</span> onClick=&#123;<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        setIsShowModal(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 顺便清空表单</span></span><br><span class="line">        setRowData(<span class="literal">undefined</span>)</span><br><span class="line">    &#125;&#125;&gt;Add&lt;/Button&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、修改和添加都是用的同一个回调函数（onOk触发表单的submit），修改有id，而添加没有</span><br><span class="line">    <span class="keyword">const</span> onFinish = <span class="function">(<span class="params">values: any</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> id = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span>(rowData)&#123;</span><br><span class="line">            id = rowData.id <span class="comment">// rowData的setRowData的默认值为undefined</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(id)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;edit)</span></span><br><span class="line"><span class="string">            dispatch(&#123;</span></span><br><span class="line"><span class="string">                type:&#x27;users/edit&#x27;, // 页面写法一定要这样子写</span></span><br><span class="line"><span class="string">                payload:&#123;</span></span><br><span class="line"><span class="string">                    values,</span></span><br><span class="line"><span class="string">                    id // 把id传到model中</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;else&#123;</span></span><br><span class="line"><span class="string">            console.log(&quot;</span>add<span class="string">&quot;)</span></span><br><span class="line"><span class="string">            dispatch(&#123;</span></span><br><span class="line"><span class="string">                type:&quot;</span>users/add<span class="string">&quot;,</span></span><br><span class="line"><span class="string">                payload:&#123;</span></span><br><span class="line"><span class="string">                    values</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        // 修改成功之后关闭弹窗</span></span><br><span class="line"><span class="string">        setIsShowModal(false);</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">03、</span></span><br><span class="line"><span class="string">effects:&#123;</span></span><br><span class="line"><span class="string">    *add(&#123;payload:&#123;values&#125;&#125;,&#123;put,call&#125;)&#123;</span></span><br><span class="line"><span class="string">        const data = yield call(addOneList,&#123;values&#125;)</span></span><br><span class="line"><span class="string">        yield put(&#123;</span></span><br><span class="line"><span class="string">            type:&#x27;getRemote&#x27;</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">04、</span></span><br><span class="line"><span class="string">export const addOneList = async (&#123;values&#125;) =&gt;&#123;</span></span><br><span class="line"><span class="string">  return request(`http://public-api-v1.aspirantzhang.com/users`,&#123;</span></span><br><span class="line"><span class="string">    method:&#x27;post&#x27;,</span></span><br><span class="line"><span class="string">    data:values</span></span><br><span class="line"><span class="string">  &#125;).then(res=&gt;&#123;</span></span><br><span class="line"><span class="string">    console.log(&quot;</span>ok<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    // 添加成功之后给提示</span></span><br><span class="line"><span class="string">    message.success(&quot;</span>Add successfully<span class="string">&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &#125;).catch(err=&gt;&#123;</span></span><br><span class="line"><span class="string">    console.log(err);</span></span><br><span class="line"><span class="string">    message.error(&quot;</span>Add failed<span class="string">&quot;)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意：现在有一个bug：点击编辑，取消后，点添加，表单的数据会遗留下来</span></span><br><span class="line"><span class="string">当初给表单赋值的时候是在，弹框显示与否的副作用里面</span></span><br><span class="line"><span class="string">当点击编辑的时候，保存这一行的值，并传到子组件里面，在弹框显示与否中给表单付初始值</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">useEffect(()=&gt;&#123;</span></span><br><span class="line"><span class="string">    if(rowData === undefined)&#123; // 点击添加按钮的时候，设置的undefined。setRowData(undefined)</span></span><br><span class="line"><span class="string">        form.resetFields();</span></span><br><span class="line"><span class="string">    &#125;else&#123;</span></span><br><span class="line"><span class="string">        form.setFieldsValue(rowData)</span></span><br><span class="line"><span class="string">    &#125; // 如果是undefined就清空，否则赋值</span></span><br><span class="line"><span class="string">&#125;,[visible])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意：给表单赋值form.setFieldsValue(rowData)，如果rowData为无效值（undefined），则表单赋值不生效</span></span><br></pre></td></tr></table></figure>
<h3 id="http-状态错误处理及提示优化（umi-request）"><a href="#http-状态错误处理及提示优化（umi-request）" class="headerlink" title="http 状态错误处理及提示优化（umi-request）"></a>http 状态错误处理及提示优化（umi-request）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request, &#123; extend &#125; <span class="keyword">from</span> <span class="string">&quot;umi-request&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> errorHandler = <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> codeMap = &#123;</span><br><span class="line">    <span class="string">&quot;021&quot;</span>: <span class="string">&quot;An error has occurred&quot;</span>,</span><br><span class="line">    <span class="string">&quot;022&quot;</span>: <span class="string">&quot;It’s a big mistake,&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (error.response) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error.response.status) <span class="comment">// 状态码</span></span><br><span class="line">    <span class="built_in">console</span>.log(error.response.headers) <span class="comment">// 头部</span></span><br><span class="line">    <span class="built_in">console</span>.log(error.data) <span class="comment">// 主体内容</span></span><br><span class="line">    <span class="built_in">console</span>.log(error.request) <span class="comment">// 请求相关的信息（例如网址）</span></span><br><span class="line">    <span class="built_in">console</span>.log(codeMap[error.data.status]) <span class="comment">// 相应状态码的提示信息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理逻辑</span></span><br><span class="line">    <span class="keyword">if</span>(error.response.status &gt; <span class="number">400</span>)&#123;</span><br><span class="line">      message.error(error.data.message?error.data.message:error.data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 请求发送了，但是没有收到回复</span></span><br><span class="line">    <span class="comment">// console.log(error.message)</span></span><br><span class="line">    message.error(<span class="string">&quot;Network Error&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// throw error // If throw. The error will continue to be thrown. // 上面做了错误处理，再抛出错误，会再抛，友好提示已经做了，就无须再抛了</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1. Unified processing</span></span><br><span class="line"><span class="keyword">const</span> extendRequest = extend(&#123; errorHandler &#125;)</span><br><span class="line"></span><br><span class="line">********** 把下面的request换成extendRequest ******************</span><br><span class="line">修改显示逻辑</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRemoteList = <span class="keyword">async</span> params =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> extendRequest(<span class="string">&#x27;http://public-api-v1.aspiranzhang.com/users&#x27;</span>,&#123;</span><br><span class="line">    method:<span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res <span class="comment">// 有结果的返回结果</span></span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 否则返回布尔值</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">增加、修改、删除无实际返回结果，改为</span><br><span class="line">.then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span> <span class="comment">// 操作成功</span></span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// 操作失败</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">****************** 现在service返回布尔值给model *****************</span><br><span class="line">所以如果返回的是值，布尔判断也为<span class="literal">true</span></span><br><span class="line">umi-request先做了一层拦截，service返回数据或者布尔值给到model，model中给出友好提示</span><br><span class="line">effets:&#123;</span><br><span class="line">  *<span class="function"><span class="title">getRemote</span>(<span class="params">action,&#123;put,call&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">yield</span> call(getRemoteList);</span><br><span class="line">    <span class="keyword">if</span>(data)&#123; <span class="comment">// 这样就保证了reducers的返回值不是undefined</span></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type:<span class="string">&quot;getList&quot;</span>,</span><br><span class="line">        payload:data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;，</span><br><span class="line">  *<span class="function"><span class="title">edit</span>(<span class="params">&#123;payload:&#123;id,values&#125;&#125;,&#123;put,call&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">yield</span> call(editRecord,&#123;id,values&#125;);</span><br><span class="line">    <span class="keyword">if</span>(data)&#123;</span><br><span class="line">      message.success(<span class="string">&#x27;Edit,success.&#x27;</span>)</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type:<span class="string">&#x27;getRemote&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      message.error(<span class="string">&#x27;Edit failed.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service与后端打交道，所以错误处理在request这里，</span><br></pre></td></tr></table></figure>
<h3 id="列表显示加载中-loading"><a href="#列表显示加载中-loading" class="headerlink" title="列表显示加载中(loading)"></a>列表显示加载中(loading)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">loading是在state里面的</span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123; users, loading &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(loading)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    users,</span><br><span class="line">    userListLoading: loading.models.users,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">使用：</span><br><span class="line">&lt;Table loading=&#123;userListLoading&#125; /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="使用-ts-进行加持"><a href="#使用-ts-进行加持" class="headerlink" title="使用 ts 进行加持"></a>使用 ts 进行加持</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">interface UserModelType &#123;</span><br><span class="line">  state: UserState;</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    getList: Reducer&lt;UserState&gt;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface UserState &#123;</span><br><span class="line">  data: SingleUserType[];</span><br><span class="line">  meta: &#123;</span><br><span class="line">    total: number,</span><br><span class="line">    per_page: number,</span><br><span class="line">    page: number,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface SingleUserType &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">  email: string;</span><br><span class="line">  create_time: string;</span><br><span class="line">  update_time: string;</span><br><span class="line">  status: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserModel: UserModelType = &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    data: [],</span><br><span class="line">    meta: &#123;</span><br><span class="line">      total: <span class="number">0</span>,</span><br><span class="line">      per_page: <span class="number">5</span>,</span><br><span class="line">      page: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、</span><br><span class="line"><span class="keyword">import</span> &#123; Dispatch,Loading,UserState &#125; <span class="keyword">from</span> <span class="string">&quot;umi&quot;</span></span><br><span class="line"><span class="comment">// umi里面可以导出在model里面定义暴露的接口</span></span><br><span class="line">interface UserListPage &#123;</span><br><span class="line">  <span class="comment">// users:[];</span></span><br><span class="line">  users:UserState;</span><br><span class="line">  dispatch:Dispatch;</span><br><span class="line">  userListLoading:boolean</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">&#123; users, loading &#125;:&#123;users:*** UserState ***,loading:Loading&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(loading)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    users,</span><br><span class="line">    userListLoading: loading.models.users,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、</span><br><span class="line"><span class="keyword">import</span> &#123; FC &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; SingleUserType &#125; <span class="keyword">from</span> <span class="string">&quot;data.d&quot;</span></span><br><span class="line"></span><br><span class="line">interface FormValues &#123;</span><br><span class="line">  [name: string]: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface UserModalProps &#123;</span><br><span class="line">  visible: boolean;</span><br><span class="line">  record: SingleUserType | <span class="literal">undefined</span>; <span class="comment">// 因为在setRowData的时候赋值了undefined</span></span><br><span class="line">  closeHandler: <span class="function">() =&gt;</span> <span class="keyword">void</span>; <span class="comment">// 无参无返回值</span></span><br><span class="line">  onFinish: <span class="function">(<span class="params">values: FormValues</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">****** 对于TS对props的写法 ******</span><br><span class="line"><span class="comment">// 01、泛型---约束props的写法</span></span><br><span class="line"><span class="keyword">const</span> UserModal: FC&lt;UserModalProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 02、使用两个对象的形式写法</span></span><br><span class="line">(&#123;&#125;:&#123;&#125;)</span><br><span class="line">对于对象的写法（写两个对象）</span><br><span class="line">&#123;id,values&#125;:&#123;<span class="attr">id</span>:number,<span class="attr">values</span>:FormValues&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、useState中定义ts（使用泛型）</span><br><span class="line"><span class="keyword">const</span> [record,setRecord] = useState&lt;SingleUserType | <span class="literal">undefined</span>&gt;(<span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure>
<h3 id="antd-的-Table-的封装-Pro-Table，request-获取数据，暂时先注释仓库里面走订阅获取数据的-dispatch"><a href="#antd-的-Table-的封装-Pro-Table，request-获取数据，暂时先注释仓库里面走订阅获取数据的-dispatch" class="headerlink" title="antd 的 Table 的封装 Pro-Table，request 获取数据，暂时先注释仓库里面走订阅获取数据的 dispatch"></a>antd 的 Table 的封装 Pro-Table，request 获取数据，暂时先注释仓库里面走订阅获取数据的 dispatch</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、引入，然后直接替换掉Table，写一个request属性获取数据</span><br><span class="line"><span class="number">02</span>、改造service接口，传入分页数据</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRemoteList = <span class="keyword">async</span> (&#123;page,per_pege&#125;)=&gt;&#123;</span><br><span class="line">  <span class="keyword">return</span> extendRequest(<span class="string">`http://public-api-v1.aspirantzhang.com/users?page=<span class="subst">$&#123;page&#125;</span>&amp;per_page=<span class="subst">$&#123;per_page&#125;</span>`</span>,&#123;</span><br><span class="line">    method:<span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">在使用到getRemoteList的地方传入对应的参数就行</span><br><span class="line">页面request获取数据写法</span><br><span class="line"><span class="keyword">const</span> requestHander = <span class="keyword">async</span> (&#123;pageSize,current&#125;)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> users = <span class="keyword">await</span> getRemoteList(&#123;</span><br><span class="line">    page:current,</span><br><span class="line">    per_page:pageSize</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span>(users)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="comment">// pro-table的表格数据</span></span><br><span class="line">        data:users.data,</span><br><span class="line">        success:<span class="literal">true</span>,</span><br><span class="line">        total:users.meta.total</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        data:[],</span><br><span class="line">        success:<span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、修改删除逻辑</span><br><span class="line">在model怎么拿到仓库的数据呢？</span><br><span class="line">select方法就可</span><br><span class="line">*<span class="function"><span class="title">delete</span>(<span class="params">&#123;payload:&#123;id&#125;&#125;,&#123;put,call,select&#125;</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">yield</span> call(deleteOneList,&#123;id&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 成功之后更新页面</span></span><br><span class="line">  <span class="keyword">if</span>(data)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;page,per_page&#125; = ***<span class="keyword">yield</span>*** select(<span class="function"><span class="params">state</span>=&gt;</span>state.***users***.meta)</span><br><span class="line">    <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type:<span class="string">&quot;getRemote&quot;</span>,</span><br><span class="line">        <span class="comment">// 因为调用getRemote要用到page和per_page,所以多传递一个payload字段</span></span><br><span class="line">        payload:&#123;</span><br><span class="line">          page,</span><br><span class="line">          per_page</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    message.error(<span class="string">&quot;Delete Failed&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">*<span class="function"><span class="title">getRemote</span>(<span class="params">&#123;payload:&#123;page,per_page&#125;&#125;,&#123;put,call&#125;</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">yield</span> call(getRemoteList,&#123;page,per_page&#125;)</span><br><span class="line">  <span class="keyword">if</span>(data)&#123;</span><br><span class="line">    <span class="keyword">yield</span> put(&#123; <span class="comment">// 传递数据给页面</span></span><br><span class="line">      type:<span class="string">&quot;getList&quot;</span>,</span><br><span class="line">      payload:data</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="复用-pro-table-的-reload-方法"><a href="#复用-pro-table-的-reload-方法" class="headerlink" title="复用 pro-table 的 reload 方法"></a>复用 pro-table 的 reload 方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、引入interface</span><br><span class="line"><span class="number">02</span>、定义ref</span><br><span class="line"><span class="number">03</span>、赋值table：actionRef=&#123;ref&#125;</span><br><span class="line"><span class="number">04</span>、点击reload的时候</span><br><span class="line"><span class="keyword">const</span> reloadHandler = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  ref.current.reload()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看文件夹结构;</span><br><span class="line">tree / f;</span><br><span class="line">网站：ctrl+home回到顶部</span><br></pre></td></tr></table></figure>
<h3 id="antd-的-Table-默认会找-dataSource-里面的-key-属性值当做自己的-rowKey"><a href="#antd-的-Table-默认会找-dataSource-里面的-key-属性值当做自己的-rowKey" class="headerlink" title="antd 的 Table 默认会找 dataSource 里面的 key 属性值当做自己的 rowKey"></a>antd 的 Table 默认会找 dataSource 里面的 key 属性值当做自己的 rowKey</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、Table必须要有唯一的rowKey值</span><br><span class="line"><span class="number">02</span>、Modal中的Form控制台报错，强制预渲染Modal</span><br><span class="line"><span class="number">03</span>、react生命周期render是不能有setState更新</span><br><span class="line"><span class="number">04</span>、在model同一个中的subscribtion订阅中dispatch的时候，type可以直接写effects或者reducers中的函数名字，但在页面和仓库沟通时候的dispatch的type要加上namespace：<span class="string">&quot;users/edit&quot;</span></span><br><span class="line"><span class="number">05</span>、******* reducers不允许返回<span class="literal">undefined</span> ******************</span><br><span class="line"><span class="number">06</span>、model中定义的接口interface，导出后，可以很神奇的在umi中导入进来</span><br><span class="line"><span class="number">07</span>、很多文件都要用的接口，可单独新建一个文件夹写接口data.d.ts,使用的时候导入,可以省略ts结尾的文件</span><br><span class="line"><span class="number">08</span>、对于太复杂的数据，判断类型直接使用any</span><br><span class="line"><span class="number">09</span>、表单提交失败的情况一般是校验不通过的时候触发onFinishFailed</span><br><span class="line"><span class="number">10</span>、pro-table的刷新是基于request方法来的，使用antd的Pagination的话，request和reload就失效了</span><br></pre></td></tr></table></figure>
<h3 id="useState-这个-hook-在-set-之后的下一步怎么获取到最新状态"><a href="#useState-这个-hook-在-set-之后的下一步怎么获取到最新状态" class="headerlink" title="useState 这个 hook 在 set 之后的下一步怎么获取到最新状态"></a>useState 这个 hook 在 set 之后的<strong><em>下一步</em></strong>怎么获取到最新状态</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、直接不使用set更新状态</span><br><span class="line"><span class="number">02</span>、利用useRef</span><br><span class="line"><span class="number">03</span>、结合useEffect</span><br><span class="line"></span><br><span class="line">具体写法有待研究</span><br><span class="line">Table的某一行可以直接拿到这一样的数据啊</span><br><span class="line"></span><br><span class="line">你都已经可以set了，说明可以直接用了啊，就可以不参与状态了</span><br><span class="line"></span><br><span class="line">修改成功之后关闭弹窗，刷新的话就是重新调用一下列表，删除也同理</span><br></pre></td></tr></table></figure>
<h3 id="umi-request-请求流程："><a href="#umi-request-请求流程：" class="headerlink" title="umi-request 请求流程："></a>umi-request 请求流程：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">本地访问远程会发送两次请求</span><br><span class="line">第一次options请求询问远程支持什么方式的请求</span><br><span class="line">第二次才是真正的前后端交互</span><br><span class="line"></span><br><span class="line">umi的请求主体直接是在error.data里面</span><br><span class="line">umi-request则在json对象里面：error.data.message</span><br></pre></td></tr></table></figure>
<h3 id="本-demo-页面加载流程-思路逻辑"><a href="#本-demo-页面加载流程-思路逻辑" class="headerlink" title="本 demo 页面加载流程-思路逻辑"></a>本 demo 页面加载流程-思路逻辑</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">约定式路由在进入某一个页面之后，订阅者会监听路径，触发相应的effects和reducers，得到数据之后返回给页面</span><br><span class="line">在使用pro-table的时候，首先页面监听，然后触发pro-table的request属性，请求数据，但是reducers还在等异步结果</span><br><span class="line">所以表格没数据，但是使用pro-table刷新一下就有了（又运行了一下request）</span><br><span class="line"></span><br><span class="line">解决：pro-table直接使用异步接口返回数据（绕过仓库，直接使用接口）（仓库和页面各自走各自的）</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、</span><br><span class="line">隐藏查询：api</span><br><span class="line">search属性置为<span class="literal">false</span></span><br><span class="line"><span class="number">02</span>、</span><br><span class="line">pro-table的分页是定死的，如果后端出错，分页显示调到对应页了，但数据是原来页的</span><br><span class="line">如果改用antd的分页，则pro-table的request和reload也不能用了</span><br><span class="line">pagination=&#123;<span class="literal">false</span>&#125; 取消pro-table的默认分页，引入antd的Pagination，model处重新订阅getRemote获取数据</span><br><span class="line">是第一次，给page和per_page默认值</span><br><span class="line"><span class="keyword">if</span>(pathname === <span class="string">&quot;/users&quot;</span>)&#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type:<span class="string">&quot;getRemote&quot;</span>,</span><br><span class="line">    payload:&#123;</span><br><span class="line">      page:<span class="number">1</span>,</span><br><span class="line">      per_page:<span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;Pagination</span><br><span class="line">  total=&#123;users.meta.total&#125;</span><br><span class="line">  onChange=&#123;paginationHandler&#125;</span><br><span class="line">  onShowSizeChange=&#123;paginationHandler&#125;</span><br><span class="line">  current=&#123;users.meta.page&#125; <span class="comment">// 通过后端来控制显示当前页（解决切换页码数据失败的问题）</span></span><br><span class="line">  pageSize=&#123;users.meta.per_page&#125; <span class="comment">// 通过后端来显示默认显示多少条（解决第一页显示五条，第二页显示10条的问题）</span></span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、分页回调</span><br><span class="line"><span class="keyword">const</span> paginationHandler = <span class="function">(<span class="params">page: number, pageSize?: number</span>) =&gt;</span> &#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type: <span class="string">&#x27;users/getRemote&#x27;</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      page,</span><br><span class="line">      per_page: pageSize ? pageSize : users.meta.per_page,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pageSizeHandler = <span class="function">(<span class="params">current: number, size: number</span>) =&gt;</span> &#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type: <span class="string">&#x27;users/getRemote&#x27;</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      page: current,</span><br><span class="line">      per_page: size,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="大-Bug，错误处理，必须-throw-error，后端接口才会捕捉-catch，然后-return-我们写的-false"><a href="#大-Bug，错误处理，必须-throw-error，后端接口才会捕捉-catch，然后-return-我们写的-false" class="headerlink" title="大 Bug，错误处理，必须 throw error，后端接口才会捕捉 catch，然后 return 我们写的 false"></a>大 Bug，错误处理，必须 throw error，后端接口才会捕捉 catch，然后 return 我们写的 false</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、</span><br><span class="line">优化：</span><br><span class="line">编辑后台失败的时候，不要关闭弹窗</span><br><span class="line">最好的效果是：点击提交后显示loading，成功后关闭，失败后不关闭弹框</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onFinish = <span class="keyword">async</span> (values:FormValues) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> id = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(record)&#123;</span><br><span class="line">    id = record.id</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(id)&#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> editRecord(&#123;id,values&#125;);</span><br><span class="line">    <span class="keyword">if</span>(result)&#123;</span><br><span class="line">      <span class="comment">// 编辑成功</span></span><br><span class="line">      setIsShowModel(<span class="literal">false</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      message.error(<span class="string">&quot;Edit Failed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> addRecord(&#123;values&#125;);</span><br><span class="line">    <span class="keyword">if</span>(result)&#123;</span><br><span class="line">      setIsShowModel(<span class="literal">false</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      message.error(<span class="string">&quot;Add failed&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、</span><br><span class="line"><span class="comment">// 简化代码</span></span><br><span class="line"><span class="keyword">let</span> serviceFun;</span><br><span class="line"><span class="keyword">if</span>(id)&#123;</span><br><span class="line">  serviceFun = editRecord</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  serviceFun = addRecord</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> serviceFun(&#123;id,values&#125;);</span><br><span class="line"><span class="keyword">if</span>(result)&#123;</span><br><span class="line">  setIsShowModel(<span class="literal">false</span>)</span><br><span class="line">  message.success(<span class="string">`<span class="subst">$&#123;id===<span class="number">0</span>?<span class="string">&quot;Add&quot;</span>:<span class="string">&quot;Edit&quot;</span>&#125;</span> Successfully.`</span>)</span><br><span class="line"></span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type:<span class="string">&quot;getRemote&quot;</span>,</span><br><span class="line">    payload:&#123;</span><br><span class="line">      page:users.meta.page,</span><br><span class="line">      per_page:users.meta.per_page</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  message.error(<span class="string">`<span class="subst">$&#123;id===<span class="number">0</span>?<span class="string">&quot;Add&quot;</span>:<span class="string">&quot;Edit&quot;</span>&#125;</span> Failed.`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、</span><br><span class="line"><span class="comment">// 点击提交的时候加一个loading状态</span></span><br><span class="line">&lt;Modal</span><br><span class="line">  confirmLoading=&#123;confirmLoading&#125;</span><br><span class="line">/&gt;</span><br><span class="line"><span class="comment">// 在父组件加一个state状态，并传递给子组件</span></span><br><span class="line"><span class="keyword">const</span> [confirmLoading,setConfirmLoading] = useState(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">// 在点击提交的时候改成true，在成功或者失败的时候都要改成false，给使用者重新提交</span></span><br><span class="line"><span class="keyword">const</span> onFinish = <span class="keyword">async</span> (values:FormValues) =&gt; &#123;</span><br><span class="line">  setConfirmLoading(<span class="literal">true</span>) <span class="comment">// 加载中</span></span><br><span class="line">  <span class="keyword">let</span> id = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> serviceFun;</span><br><span class="line">  <span class="keyword">if</span>(id)&#123;</span><br><span class="line">    serviceFun = editRecord</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    serviceFun = addRecord</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> serviceFun(&#123;id,values&#125;);</span><br><span class="line">  <span class="keyword">if</span>(result)&#123;</span><br><span class="line">    setIsShowModel(<span class="literal">false</span>)</span><br><span class="line">    message.success(<span class="string">`<span class="subst">$&#123;id===<span class="number">0</span>?<span class="string">&quot;Add&quot;</span>:<span class="string">&quot;Edit&quot;</span>&#125;</span> Successfully.`</span>)</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type:<span class="string">&quot;getRemote&quot;</span>,</span><br><span class="line">      payload:&#123;</span><br><span class="line">        page:users.meta.page,</span><br><span class="line">        per_page:users.meta.per_page</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 成功取消加载</span></span><br><span class="line">    setConfirmLoading(<span class="literal">false</span>) <span class="comment">// 加载中取消</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 失败取消加载</span></span><br><span class="line">    setConfirmLoading(<span class="literal">false</span>) <span class="comment">// 加载中取消</span></span><br><span class="line">    message.error(<span class="string">`<span class="subst">$&#123;id===<span class="number">0</span>?<span class="string">&quot;Add&quot;</span>:<span class="string">&quot;Edit&quot;</span>&#125;</span> Failed.`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="重写实现-reload"><a href="#重写实现-reload" class="headerlink" title="重写实现 reload"></a>重写实现 reload</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;ProTable</span><br><span class="line">  options=&#123;&#123;</span><br><span class="line">    density: <span class="literal">true</span>,</span><br><span class="line">    fullScreen: <span class="literal">true</span>,</span><br><span class="line">    reload: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resetHandler();</span><br><span class="line">    &#125;,</span><br><span class="line">    setting: <span class="literal">true</span>,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  <span class="comment">// 添加title</span></span><br><span class="line">  headerTitle=<span class="string">&quot;User List&quot;</span></span><br><span class="line">  toolBarRender=&#123;<span class="function">() =&gt;</span> [</span><br><span class="line">    &lt;Button type=<span class="string">&quot;primary&quot;</span> onClick=&#123;addHandler&#125;&gt;</span><br><span class="line">      Add</span><br><span class="line">    &lt;/Button&gt;,</span><br><span class="line">    &lt;Button onClick=&#123;resetHandler&#125;&gt;Reload&lt;/Button&gt;,</span><br><span class="line">  ]&#125;</span><br><span class="line">/&gt;;</span><br><span class="line"><span class="keyword">const</span> resetHandler = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  刷新页面就是请求下仓库数据;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type: <span class="string">&quot;users/getRemote&quot;</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      page: users.meta.page,</span><br><span class="line">      per_page: users.meta.per_page,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">现在可以删除以前写的通过ref实现的刷新功能;</span><br></pre></td></tr></table></figure>
<h3 id="Form-Item-里面给-DatePicker-赋初始值，应该在给调单赋初始值的时候"><a href="#Form-Item-里面给-DatePicker-赋初始值，应该在给调单赋初始值的时候" class="headerlink" title="Form.Item 里面给 DatePicker 赋初始值，应该在给调单赋初始值的时候"></a>Form.Item 里面给 DatePicker 赋初始值，应该在给调单赋初始值的时候</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;DatePicker showTime /&gt;;</span><br><span class="line"></span><br><span class="line">form.setFieldsValue(&#123;</span><br><span class="line">  ...record,</span><br><span class="line">  create_time: moment(record.create_time),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Input、DatePicker-给-value，Switch-给-checked"><a href="#Input、DatePicker-给-value，Switch-给-checked" class="headerlink" title="Input、DatePicker 给 value，Switch 给 checked"></a>Input、DatePicker 给 value，Switch 给 checked</h3><h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">调整表单显示布局;</span><br><span class="line"><span class="keyword">const</span> layout = &#123;</span><br><span class="line">  labelCol: &#123; <span class="attr">span</span>: <span class="number">4</span> &#125;,</span><br><span class="line">  wrapperCol: &#123; <span class="attr">span</span>: <span class="number">20</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;Form &#123;...layout&#125; /&gt;;</span><br></pre></td></tr></table></figure>
<h3 id="Modal-的-title-动态显示编辑与添加"><a href="#Modal-的-title-动态显示编辑与添加" class="headerlink" title="Modal 的 title 动态显示编辑与添加"></a>Modal 的 title 动态显示编辑与添加</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title=&#123; record ? <span class="string">&quot;Edit ID:&quot;</span> + record.id : <span class="string">&quot;Add&quot;</span> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="分页的-pageSize-是可选的、注意给默认值"><a href="#分页的-pageSize-是可选的、注意给默认值" class="headerlink" title="分页的 pageSize 是可选的、注意给默认值"></a>分页的 pageSize 是可选的、注意给默认值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pageSize?:number</span><br><span class="line"></span><br><span class="line">per_page: pageSize ? pageSize : users.meta.per_page</span><br></pre></td></tr></table></figure>
<h3 id="给表格列添加对应的字段类型（valueType）"><a href="#给表格列添加对应的字段类型（valueType）" class="headerlink" title="给表格列添加对应的字段类型（valueType）"></a>给表格列添加对应的字段类型（valueType）</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  title:<span class="string">&quot;ID&quot;</span>,</span><br><span class="line">  dataIndex:<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  valueType:<span class="string">&quot;digit&quot;</span>,</span><br><span class="line">  key:<span class="string">&#x27;id&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="给表格的列-columns-添加-ts-类型声明"><a href="#给表格的列-columns-添加-ts-类型声明" class="headerlink" title="给表格的列 columns 添加 ts 类型声明"></a>给表格的列 columns 添加 ts 类型声明</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> columns: ProColumns&lt;SingleUserType&gt;[] = [&#123;&#125;, &#123;&#125;];</span><br></pre></td></tr></table></figure>
<h3 id="复用代码"><a href="#复用代码" class="headerlink" title="复用代码"></a>复用代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">添加或者编辑成功之后，要刷新列表</span><br><span class="line">直接复用刷新表格的函数：</span><br><span class="line">resetHandle()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="点击添加的时候—给表单项的开关赋初始值"><a href="#点击添加的时候—给表单项的开关赋初始值" class="headerlink" title="点击添加的时候—给表单项的开关赋初始值"></a>点击添加的时候—给表单项的开关赋初始值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form</span><br><span class="line">  initialValues=&#123;&#123;</span><br><span class="line">    status: <span class="literal">true</span>,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="编辑的时候开关的显示开与否，转后端给的值为布尔值"><a href="#编辑的时候开关的显示开与否，转后端给的值为布尔值" class="headerlink" title="编辑的时候开关的显示开与否，转后端给的值为布尔值"></a>编辑的时候开关的显示开与否，转后端给的值为布尔值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">form.setFieldsValue(&#123;</span><br><span class="line">  ...record,</span><br><span class="line">  create_time: moment(record.create_time),</span><br><span class="line">  status: <span class="built_in">Boolean</span>(record.status),</span><br><span class="line">  status: record.status === <span class="number">1</span> ? <span class="literal">true</span> : <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="捋思路"><a href="#捋思路" class="headerlink" title="捋思路"></a>捋思路</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">添加逻辑：</span><br><span class="line">        点击添加，显示弹框，清空表单</span><br><span class="line">        表单编辑好后、点击提交，根据全局的rowData判断有无id</span><br><span class="line">        有，是编辑</span><br><span class="line">        无，是添加，dispatch一个add的effect，带上type和payload</span><br><span class="line">        编辑成功，关闭弹窗</span><br><span class="line"></span><br><span class="line">        model逻辑：去写effect，去写service</span><br><span class="line"></span><br><span class="line">        此时实现添加，但是有个bug（点编辑后取消编辑，去添加会遗留编辑的数据），在添加的时候，要清空表单（表单内容是从父级传递过来的）</span><br><span class="line">        useEffect(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(rowData === <span class="literal">undefined</span>)&#123; <span class="comment">// 点击添加按钮的时候，设置的undefined。setRowData(undefined)</span></span><br><span class="line">                form.resetFields();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                form.setFieldsValue(rowData)  ******  如果rowData为无效值，表单赋值不生效 ******</span><br><span class="line">            &#125; <span class="comment">// 如果是undefined就清空，否则赋值</span></span><br><span class="line">        &#125;,[visible])</span><br><span class="line"></span><br><span class="line">错误提示优化：</span><br><span class="line">            service层有值的返回值，无值的返回布尔值给model</span><br></pre></td></tr></table></figure>
<h3 id="useEffect-第二个参数如果是常量，则代表不会变"><a href="#useEffect-第二个参数如果是常量，则代表不会变" class="headerlink" title="useEffect 第二个参数如果是常量，则代表不会变"></a>useEffect 第二个参数如果是常量，则代表不会变</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function">() =&gt;</span> &#123;&#125;, [<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="真正组件化"><a href="#真正组件化" class="headerlink" title="真正组件化"></a>真正组件化</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、每一部分都拆开成一个函数组件，然后调用:&#123;name()&#125;    ***************************************************************</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、&#123; variable &amp;&amp; <span class="built_in">Object</span>.keys(variable).length? (ReactNode) : <span class="literal">null</span> &#125; <span class="comment">// 这里面可以判断要不要渲染某个组件</span></span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、partial&lt;T&gt; : 则T里面的属性代表可选，partial(可以直接引用)</span><br><span class="line"></span><br><span class="line"><span class="number">04</span>、分步骤是通过一个变量来判断是第几步，返回对应的reactNode</span><br><span class="line"></span><br><span class="line"><span class="number">05</span>、表单校验</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文本域</span></span><br><span class="line">&lt;FormItem</span><br><span class="line">  name=<span class="string">&quot;desc&quot;</span>,</span><br><span class="line">  label=<span class="string">&quot;规则描述&quot;</span>,</span><br><span class="line">  rules=&#123;[</span><br><span class="line">    &#123;</span><br><span class="line">      requied:<span class="literal">true</span>,</span><br><span class="line">      message:<span class="string">&#x27;请输入至少五个字符的规则描述！&#x27;</span>,</span><br><span class="line">      min:<span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;TextArea rows=&#123;<span class="number">4</span>&#125; placeholder=<span class="string">&quot;请输入至少五个字符&quot;</span> /&gt;</span><br><span class="line">&lt;/FormItem&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间范围选择</span></span><br><span class="line">&lt;FormItem</span><br><span class="line">  name=<span class="string">&quot;time&quot;</span>,</span><br><span class="line">  label=<span class="string">&quot;开始时间&quot;</span>,</span><br><span class="line">  rules=&#123;[</span><br><span class="line">    &#123;</span><br><span class="line">      requied:<span class="literal">true</span>,</span><br><span class="line">      message:<span class="string">&#x27;请选择开始时间！&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ]&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;DatePicker style=&#123;&#123; <span class="attr">width</span> : <span class="string">&#x27;100%&#x27;</span> &#125;&#125;</span><br><span class="line">    showTime</span><br><span class="line">    format=<span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span></span><br><span class="line">    placeholder=<span class="string">&quot;选择开始时间&quot;</span></span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/FormItem&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下拉框</span></span><br><span class="line">&lt;FormItem</span><br><span class="line">  name=<span class="string">&quot;frequency&quot;</span>,</span><br><span class="line">  label=<span class="string">&quot;调度周期&quot;</span>,</span><br><span class="line">&gt;</span><br><span class="line">  &lt;Select</span><br><span class="line">    style=&#123;&#123;<span class="attr">width</span>:<span class="string">&#x27;100%&#x27;</span>&#125;&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;Option value=<span class="string">&quot;month&quot;</span>&gt;月&lt;/Option&gt;</span><br><span class="line">    &lt;Option value=<span class="string">&quot;week&quot;</span>&gt;周&lt;/Option&gt;</span><br><span class="line">  &lt;/Select&gt;</span><br><span class="line">&lt;/FormItem&gt;</span><br></pre></td></tr></table></figure>
<h3 id="编辑和删除"><a href="#编辑和删除" class="headerlink" title="编辑和删除"></a>编辑和删除</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> editAndDelete = <span class="function">(<span class="params">key, currentItem</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (key === <span class="string">&quot;edit&quot;</span>) showEditModal(currentItem);</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (key === <span class="string">&quot;delete&quot;</span>) &#123;</span><br><span class="line">    Modal.confirm(&#123;</span><br><span class="line">      title: <span class="string">&quot;删除任务&quot;</span>,</span><br><span class="line">      content: <span class="string">&quot;确定删除改任务吗？&quot;</span>,</span><br><span class="line">      okText: <span class="string">&quot;确认&quot;</span>,</span><br><span class="line">      cancelText: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">      onOk: <span class="function">() =&gt;</span> deleteItem(currentItem.id),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="更多-hover-显示菜单"><a href="#更多-hover-显示菜单" class="headerlink" title="更多 hover 显示菜单"></a>更多 hover 显示菜单</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MoreBtn = <span class="function">(<span class="params">&#123; item &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;Dropdown</span><br><span class="line">    overlay=&#123;</span><br><span class="line">      &lt;Menu onClick=&#123;<span class="function">(<span class="params">&#123; key &#125;</span>) =&gt;</span> editAndDelete(key, item)&#125;&gt;</span><br><span class="line">        &lt;Menu.Item key=<span class="string">&quot;edit&quot;</span>&gt;编辑&lt;/Menu.Item&gt;</span><br><span class="line">        &lt;Menu.Item key=<span class="string">&quot;delete&quot;</span>&gt;删除&lt;/Menu.Item&gt;</span><br><span class="line">      &lt;/Menu&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;a&gt;</span><br><span class="line">      更多 &lt;DownOutLined /&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">  &lt;/Dropdown&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="通知-reducers"><a href="#通知-reducers" class="headerlink" title="通知 reducers"></a>通知 reducers</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">yield</span> put(&#123;</span><br><span class="line">  type:<span class="string">&#x27;queryList&#x27;</span>,</span><br><span class="line">  payload:<span class="built_in">Array</span>.isArrray(result)?result:[]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="判断添加成功与否"><a href="#判断添加成功与否" class="headerlink" title="判断添加成功与否"></a>判断添加成功与否</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleAdd = <span class="keyword">async</span> (fields) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> hide = message.loading(<span class="string">&quot;正在添加&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> addRule(&#123;</span><br><span class="line">      desc: fields.desc,</span><br><span class="line">    &#125;);</span><br><span class="line">    hide();</span><br><span class="line">    message.success(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    hide();</span><br><span class="line">    message.error(<span class="string">&quot;添加失败请重试！&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="umijs-plugin-model-的使用"><a href="#umijs-plugin-model-的使用" class="headerlink" title="@umijs/plugin-model 的使用"></a>@umijs/plugin-model 的使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">src/models/zhang.js，里面的每个文件暴露一个***需要默认导出***一个函数</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> myName = <span class="string">&quot;zhang&quot;</span></span><br><span class="line">  <span class="keyword">return</span> &#123; myName &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">文件名则对应最终 model 的 name，你可以通过插件提供的 API 来消费 model 中的数据</span><br><span class="line">useModel 是一个 Hook，提供消费 Model 的能力，使用示例如下</span><br><span class="line"><span class="keyword">import</span> &#123; useModel &#125; <span class="keyword">from</span> <span class="string">&#x27;umi&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; myName &#125; = useModel(<span class="string">&#x27;zhang&#x27;</span>) <span class="comment">//model的name就是文件名</span></span><br><span class="line">其他地方即可使用***myName***</span><br></pre></td></tr></table></figure>
<h3 id="为啥要使用泛型"><a href="#为啥要使用泛型" class="headerlink" title="为啥要使用泛型"></a>为啥要使用泛型</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">做到对类型的灵活控制;</span><br></pre></td></tr></table></figure>
<h3 id="表单初始值，umi-路由跳转，插件"><a href="#表单初始值，umi-路由跳转，插件" class="headerlink" title="表单初始值，umi 路由跳转，插件"></a>表单初始值，umi 路由跳转，插件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01</span>、</span><br><span class="line">reducer一调用就代表仓库给页面返回值了;</span><br><span class="line"></span><br><span class="line"><span class="number">02</span>、</span><br><span class="line">约定式路由（无路由配置）</span><br><span class="line">（有订阅者先走订阅者（初始化仓库），protable的request不走）</span><br><span class="line"></span><br><span class="line">不走订阅，走request，则仓库初始化不了</span><br><span class="line">正常来说走仓库（例如删除成功之后可以直接通过select方法获取仓库数据）</span><br><span class="line"></span><br><span class="line"><span class="number">03</span>、刷新是基于request的，有request才有protable自带的刷新</span><br><span class="line">分页也是基于request的，有request才有分页</span><br></pre></td></tr></table></figure>
<h3 id="Form-的默认值只给表单的赋值是-value-的"><a href="#Form-的默认值只给表单的赋值是-value-的" class="headerlink" title="Form 的默认值只给表单的赋值是 value 的"></a>Form 的默认值只给表单的赋值是 value 的</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果是checked，需要在Form.Item上声明valuePropName=<span class="string">&quot;checked&quot;</span>,然后给表单赋初始值才会生效,</span><br><span class="line"></span><br><span class="line">给表单在初始化的时候赋值：initialValues=&#123;&#123;...:...&#125;&#125;</span><br></pre></td></tr></table></figure>
      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>张周文</li>
    <li><strong>本文链接：</strong><a href="http://dachuizi-6.github.io/2021/02/25/14%E3%80%81umi3-dva%E5%85%A5%E9%97%A8/index.html" title="http:&#x2F;&#x2F;dachuizi-6.github.io&#x2F;2021&#x2F;02&#x2F;25&#x2F;14%E3%80%81umi3-dva%E5%85%A5%E9%97%A8&#x2F;index.html">http:&#x2F;&#x2F;dachuizi-6.github.io&#x2F;2021&#x2F;02&#x2F;25&#x2F;14%E3%80%81umi3-dva%E5%85%A5%E9%97%A8&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="https://pic.izhaoo.com/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
        
  <nav class="nav">
    <a href="/2021/03/02/17%E3%80%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95/"><i class="iconfont iconleft"></i>17</a>
    <a href="/2021/02/22/13%E3%80%81css%E9%A2%84%E5%A4%84%E7%90%86%E4%B9%8Bless/">13、less<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-text">基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DVA-%E4%BB%8B%E7%BB%8D"><span class="toc-text">DVA 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E4%BE%8B%E5%AD%90%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">小例子文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%9F%BA%E7%A1%80%E9%A1%B5%E9%9D%A2"><span class="toc-text">搭建基础页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umi-%E8%B7%9F-dva-%E7%BB%93%E5%90%88"><span class="toc-text">umi 跟 dva 结合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%B0%E8%AE%A2%E9%98%85%E5%92%8C-reducer"><span class="toc-text">走订阅和 reducer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TS-%E5%8A%A0%E6%8C%81"><span class="toc-text">TS 加持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%B0%E8%AE%A2%E9%98%85-effect-reducer-connect"><span class="toc-text">走订阅+effect+reducer+connect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B%E6%95%B0%E6%8D%AE%E6%B5%81-service%E2%80%94-gt-effects%E2%80%94-gt-reducer"><span class="toc-text">异步处理完整流程数据流 service—&gt;effects—&gt;reducer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dav-%E7%94%A8%E6%9D%A5-model-%E8%87%AA%E5%8A%A8%E5%90%AF%E7%94%A8"><span class="toc-text">Dav:用来 model 自动启用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86-%E5%8F%AA%E5%9C%A8%E5%BC%80%E5%8F%91%E7%9A%84%E6%97%B6%E5%80%99%E5%A5%BD%E4%BD%BF"><span class="toc-text">代理,只在开发的时候好使</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umi-%E7%9A%84%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE"><span class="toc-text">umi 的一些配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A5%87%E6%80%AA%E7%9A%84%E7%82%B9"><span class="toc-text">奇怪的点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5-Modal-%E5%AD%90%E7%BB%84%E4%BB%B6%EF%BC%8C%E9%80%9A%E8%BF%87%E5%B1%9E%E6%80%A7%E7%9A%84%E6%96%B9%E5%BC%8F%E6%8E%A7%E5%88%B6%E6%98%BE%E7%A4%BA%E5%BD%B1%E8%97%8F%EF%BC%88%E5%9C%A8%E7%88%B6%E7%BB%84%E4%BB%B6%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%8A%B6%E6%80%81%EF%BC%89"><span class="toc-text">引入 Modal 子组件，通过属性的方式控制显示影藏（在父组件定义一个状态）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-text">接下来的流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB-Modal-%E7%9A%84-ok-%E6%9D%A5%E8%A7%A6%E5%8F%91%E8%A1%A8%E5%8D%95%E7%9A%84%E6%8F%90%E4%BA%A4"><span class="toc-text">****************点击 Modal 的 ok 来触发表单的提交****************</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E4%BF%AE%E6%94%B9%E9%80%BB%E8%BE%91"><span class="toc-text">处理修改逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%AE%8C%E4%BF%AE%E6%94%B9%E5%90%8E%EF%BC%8C%E5%BA%94%E8%AF%A5%E8%B0%83%E7%94%A8-%E5%BC%82%E6%AD%A5%E7%9A%84-effect-%E8%AF%B7%E6%B1%82%E5%88%97%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-text">处理完修改后，应该调用***********异步的 effect 请求列表数据*****************</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%88%A0%E9%99%A4%E9%80%BB%E8%BE%91"><span class="toc-text">处理删除逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%B7%BB%E5%8A%A0%E9%80%BB%E8%BE%91"><span class="toc-text">处理添加逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-%E7%8A%B6%E6%80%81%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%8F%8A%E6%8F%90%E7%A4%BA%E4%BC%98%E5%8C%96%EF%BC%88umi-request%EF%BC%89"><span class="toc-text">http 状态错误处理及提示优化（umi-request）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%98%BE%E7%A4%BA%E5%8A%A0%E8%BD%BD%E4%B8%AD-loading"><span class="toc-text">列表显示加载中(loading)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-ts-%E8%BF%9B%E8%A1%8C%E5%8A%A0%E6%8C%81"><span class="toc-text">使用 ts 进行加持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#antd-%E7%9A%84-Table-%E7%9A%84%E5%B0%81%E8%A3%85-Pro-Table%EF%BC%8Crequest-%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%9A%82%E6%97%B6%E5%85%88%E6%B3%A8%E9%87%8A%E4%BB%93%E5%BA%93%E9%87%8C%E9%9D%A2%E8%B5%B0%E8%AE%A2%E9%98%85%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E7%9A%84-dispatch"><span class="toc-text">antd 的 Table 的封装 Pro-Table，request 获取数据，暂时先注释仓库里面走订阅获取数据的 dispatch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%94%A8-pro-table-%E7%9A%84-reload-%E6%96%B9%E6%B3%95"><span class="toc-text">复用 pro-table 的 reload 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-text">小技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#antd-%E7%9A%84-Table-%E9%BB%98%E8%AE%A4%E4%BC%9A%E6%89%BE-dataSource-%E9%87%8C%E9%9D%A2%E7%9A%84-key-%E5%B1%9E%E6%80%A7%E5%80%BC%E5%BD%93%E5%81%9A%E8%87%AA%E5%B7%B1%E7%9A%84-rowKey"><span class="toc-text">antd 的 Table 默认会找 dataSource 里面的 key 属性值当做自己的 rowKey</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useState-%E8%BF%99%E4%B8%AA-hook-%E5%9C%A8-set-%E4%B9%8B%E5%90%8E%E7%9A%84%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%80%8E%E4%B9%88%E8%8E%B7%E5%8F%96%E5%88%B0%E6%9C%80%E6%96%B0%E7%8A%B6%E6%80%81"><span class="toc-text">useState 这个 hook 在 set 之后的下一步怎么获取到最新状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umi-request-%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B%EF%BC%9A"><span class="toc-text">umi-request 请求流程：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC-demo-%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B-%E6%80%9D%E8%B7%AF%E9%80%BB%E8%BE%91"><span class="toc-text">本 demo 页面加载流程-思路逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7-Bug%EF%BC%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%EF%BC%8C%E5%BF%85%E9%A1%BB-throw-error%EF%BC%8C%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E6%89%8D%E4%BC%9A%E6%8D%95%E6%8D%89-catch%EF%BC%8C%E7%84%B6%E5%90%8E-return-%E6%88%91%E4%BB%AC%E5%86%99%E7%9A%84-false"><span class="toc-text">大 Bug，错误处理，必须 throw error，后端接口才会捕捉 catch，然后 return 我们写的 false</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%86%99%E5%AE%9E%E7%8E%B0-reload"><span class="toc-text">重写实现 reload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Form-Item-%E9%87%8C%E9%9D%A2%E7%BB%99-DatePicker-%E8%B5%8B%E5%88%9D%E5%A7%8B%E5%80%BC%EF%BC%8C%E5%BA%94%E8%AF%A5%E5%9C%A8%E7%BB%99%E8%B0%83%E5%8D%95%E8%B5%8B%E5%88%9D%E5%A7%8B%E5%80%BC%E7%9A%84%E6%97%B6%E5%80%99"><span class="toc-text">Form.Item 里面给 DatePicker 赋初始值，应该在给调单赋初始值的时候</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Input%E3%80%81DatePicker-%E7%BB%99-value%EF%BC%8CSwitch-%E7%BB%99-checked"><span class="toc-text">Input、DatePicker 给 value，Switch 给 checked</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-text">优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Modal-%E7%9A%84-title-%E5%8A%A8%E6%80%81%E6%98%BE%E7%A4%BA%E7%BC%96%E8%BE%91%E4%B8%8E%E6%B7%BB%E5%8A%A0"><span class="toc-text">Modal 的 title 动态显示编辑与添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E7%9A%84-pageSize-%E6%98%AF%E5%8F%AF%E9%80%89%E7%9A%84%E3%80%81%E6%B3%A8%E6%84%8F%E7%BB%99%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">分页的 pageSize 是可选的、注意给默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E8%A1%A8%E6%A0%BC%E5%88%97%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E7%9A%84%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%EF%BC%88valueType%EF%BC%89"><span class="toc-text">给表格列添加对应的字段类型（valueType）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E8%A1%A8%E6%A0%BC%E7%9A%84%E5%88%97-columns-%E6%B7%BB%E5%8A%A0-ts-%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E"><span class="toc-text">给表格的列 columns 添加 ts 类型声明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-text">复用代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E6%B7%BB%E5%8A%A0%E7%9A%84%E6%97%B6%E5%80%99%E2%80%94%E7%BB%99%E8%A1%A8%E5%8D%95%E9%A1%B9%E7%9A%84%E5%BC%80%E5%85%B3%E8%B5%8B%E5%88%9D%E5%A7%8B%E5%80%BC"><span class="toc-text">点击添加的时候—给表单项的开关赋初始值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E7%9A%84%E6%97%B6%E5%80%99%E5%BC%80%E5%85%B3%E7%9A%84%E6%98%BE%E7%A4%BA%E5%BC%80%E4%B8%8E%E5%90%A6%EF%BC%8C%E8%BD%AC%E5%90%8E%E7%AB%AF%E7%BB%99%E7%9A%84%E5%80%BC%E4%B8%BA%E5%B8%83%E5%B0%94%E5%80%BC"><span class="toc-text">编辑的时候开关的显示开与否，转后端给的值为布尔值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%8B%E6%80%9D%E8%B7%AF"><span class="toc-text">捋思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useEffect-%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0%E5%A6%82%E6%9E%9C%E6%98%AF%E5%B8%B8%E9%87%8F%EF%BC%8C%E5%88%99%E4%BB%A3%E8%A1%A8%E4%B8%8D%E4%BC%9A%E5%8F%98"><span class="toc-text">useEffect 第二个参数如果是常量，则代表不会变</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E6%AD%A3%E7%BB%84%E4%BB%B6%E5%8C%96"><span class="toc-text">真正组件化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E5%92%8C%E5%88%A0%E9%99%A4"><span class="toc-text">编辑和删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A-hover-%E6%98%BE%E7%A4%BA%E8%8F%9C%E5%8D%95"><span class="toc-text">更多 hover 显示菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5-reducers"><span class="toc-text">通知 reducers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%B7%BB%E5%8A%A0%E6%88%90%E5%8A%9F%E4%B8%8E%E5%90%A6"><span class="toc-text">判断添加成功与否</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#umijs-plugin-model-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">@umijs&#x2F;plugin-model 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E5%95%A5%E8%A6%81%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B"><span class="toc-text">为啥要使用泛型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E5%88%9D%E5%A7%8B%E5%80%BC%EF%BC%8Cumi-%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC%EF%BC%8C%E6%8F%92%E4%BB%B6"><span class="toc-text">表单初始值，umi 路由跳转，插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Form-%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%E5%8F%AA%E7%BB%99%E8%A1%A8%E5%8D%95%E7%9A%84%E8%B5%8B%E5%80%BC%E6%98%AF-value-%E7%9A%84"><span class="toc-text">Form 的默认值只给表单的赋值是 value 的</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/izhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Main - <a target="_blank" href="https://github.com/Dachuizi-6">大帅比</a></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
    <div class="scrollbar j-scrollbar">
  <div class="scrollbar-current j-scrollbar-current"></div>
</div>
  
  
    
<script src="/js/color-mode.js"></script>

  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>





  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>